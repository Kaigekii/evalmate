{% extends 'EvalMateApp/base_dashboard.html' %}
{% load static %}

{% block title %}Responses - {{ form.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'EvalMateApp/css/reports.css' %}?v=9">
{% endblock %}

{% block content %}
<div class="responses-container">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{% url 'faculty_reports' %}" class="breadcrumb__link">
            <i class="fas fa-arrow-left"></i> 
            Back to Reports
        </a>
    </div>

    <!-- Page Header - Reports Style -->
    <div class="reports-hero">
        <div class="reports-hero__content">
            <div class="reports-hero__icon">
                <i class="fas fa-clipboard-list" style="color: white;"></i>
            </div>
            <div>
                <h1 class="reports-hero__title">{{ form.title }}</h1>
                <div class="responses-header__meta">
                    <span class="meta-item" style="color: rgba(255,255,255,0.9);">
                        <i class="fas fa-graduation-cap" style="color: white;"></i>
                        {{ form.course_id|default:"No Course" }}
                    </span>
                    <span class="meta-item" style="color: rgba(255,255,255,0.9);">
                        <i class="far fa-calendar" style="color: white;"></i>
                        Created {{ form.created_at|date:"M d, Y" }}
                    </span>
                </div>
            </div>
        </div>
        <div class="reports-hero__stats">
            <div class="hero-stat">
                <div class="hero-stat__value">{{ total_responses }}</div>
                <div class="hero-stat__label">Response{{ total_responses|pluralize }}</div>
            </div>
        </div>
    </div>

    <!-- Responses List -->
    {% if grouped_responses %}
    <div class="responses-list">
        {% for group in grouped_responses %}
        <div class="response-item {% if group.has_unread %}response-item--unread{% endif %}" style="display: flex; align-items: center; padding: 1.5rem; gap: 1.5rem;">
            <div class="response-item__avatar">
                {% if is_anonymous %}
                    <span>A</span>
                {% else %}
                    {% if group.student.profile_picture_url %}
                        <img src="{{ group.student.profile_picture_url }}" alt="{{ group.student.first_name }}" class="response-item__avatar-img">
                    {% elif group.student.profile_picture %}
                        <img src="{{ group.student.profile_picture.url }}" alt="{{ group.student.first_name }}" class="response-item__avatar-img">
                    {% else %}
                        <span>{{ group.student.first_name.0 }}{{ group.student.last_name.0 }}</span>
                    {% endif %}
                {% endif %}
            </div>
            
            <div style="flex: 1; min-width: 0;">
                <div class="response-item__header">
                    <h3 class="response-item__name">
                        {% if is_anonymous %}Anonymous{% else %}{{ group.student.first_name }} {{ group.student.last_name }}{% endif %}
                    </h3>
                    {% if group.has_unread %}
                    <span class="response-item__unread-badge">
                        <i class="fas fa-circle"></i> New
                    </span>
                    {% endif %}
                </div>
                <div class="response-item__meta">
                    <span class="meta-item">
                        <i class="far fa-clock"></i>
                        {{ group.submitted_at|date:"M d, Y" }} at {{ group.submitted_at|date:"g:i A" }}
                    </span>
                    {% if not is_anonymous %}
                    <span class="meta-item">
                        <i class="fas fa-envelope"></i>
                        {{ group.student.user.email }}
                    </span>
                    {% endif %}
                    <span class="meta-item" style="padding: 0.375rem 0.75rem; background: linear-gradient(135deg, #715A5A, #8A7070); color: white; border-radius: 8px; font-weight: 600;">
                        <i class="fas fa-users" style="color: white;"></i>
                        {{ group.teammates|length }} Teammate{{ group.teammates|length|pluralize }}
                    </span>
                </div>
            </div>

            <!-- Single View Response Button -->
            <a href="{% url 'faculty_student_responses' form.id group.student.id group.team %}" style="display: inline-flex; align-items: center; gap: 0.625rem; padding: 0.875rem 1.5rem; background: linear-gradient(135deg, #37353E, #44444E); color: white; border-radius: 12px; text-decoration: none; font-weight: 600; font-size: 0.9375rem; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(55, 53, 62, 0.3); white-space: nowrap; flex-shrink: 0; margin-left: auto;">
                <i class="fas fa-eye" style="font-size: 1rem;"></i>
                <span>View Response</span>
                <i class="fas fa-arrow-right" style="font-size: 0.875rem;"></i>
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="responses-empty">
        <div class="responses-empty__icon">
            <i class="far fa-inbox"></i>
        </div>
        <h3 class="responses-empty__title">No Responses Yet</h3>
        <p class="responses-empty__text">
            When students submit this evaluation form, their responses will appear here.
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}
